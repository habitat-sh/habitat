expeditor:
  secrets:
    PIPELINE_HAB_AUTH_TOKEN:
      path: account/static/habitat/chef-ci
      field: auth_token # Production Builder
  accounts:
    - aws/chef-cd
  defaults:
    buildkite:
      timeout_in_minutes: 30
      env:
        HAB_ORIGIN: "habitat-testing" # just to be safe
        HAB_BLDR_URL: "https://bldr.habitat.sh"
        HAB_BLDR_CHANNEL: "dev"
        HAB_INTERNAL_BLDR_CHANNEL: "dev"

steps:
#######################################################################
# E2E
#######################################################################

  - label: "[:linux: test_event_stream]"
    command:
      - bash .expeditor/scripts/end_to_end/run_e2e_test.sh dev test_event_stream
    artifact_paths:
      - "*.log"
    expeditor:
      executor:
        linux:
          single-use: true
          privileged: true
          environment:
            - BUILD_PKG_TARGET=x86_64-linux


  - label: "[:linux: test_container_exporter]"
    command:
      - bash .expeditor/scripts/end_to_end/run_e2e_test.sh dev test_container_exporter
    artifact_paths:
      - "*.log"
    env:
      BUILD_PKG_TARGET: x86_64-linux
    expeditor:
      executor:
        linux:
          single-use: true
          privileged: true
