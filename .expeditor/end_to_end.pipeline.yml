expeditor:
  secrets:
    PIPELINE_HAB_AUTH_TOKEN:
      path: account/static/habitat/chef-ci
      field: auth_token # Production Builder
  accounts:
    - aws/chef-cd
  defaults:
    buildkite:
      timeout_in_minutes: 30
      env:
        HAB_ORIGIN: "habitat-testing" # just to be safe
        HAB_BLDR_URL: "https://bldr.habitat.sh"
        HAB_BLDR_CHANNEL: "dev"
        HAB_INTERNAL_BLDR_CHANNEL: "dev"

steps:
#######################################################################
# E2E
#######################################################################


  - label: "[:windows: hab-svc-load-with-svc-user]"
    command:
      - powershell .expeditor/scripts/end_to_end/run_e2e_test.ps1 dev test_supervisor_load_service_with_password
    artifact_paths:
      - "*.log"
    expeditor:
      executor:
        docker:
          host_os: windows
          environment:
            - BUILD_PKG_TARGET=x86_64-windows
            - BUILDKITE_AGENT_ACCESS_TOKEN
    retry:
      automatic:
        limit: 1


  - label: "[:windows: hab-svc-load-with-hab-user]"
    command:
      - powershell .expeditor/scripts/end_to_end/run_e2e_test.ps1 dev test_supervisor_load_with_hab_user
    artifact_paths:
      - "*.log"
    expeditor:
      executor:
        docker:
          host_os: windows
          environment:
            - BUILD_PKG_TARGET=x86_64-windows
            - BUILDKITE_AGENT_ACCESS_TOKEN
    retry:
      automatic:
        limit: 1

