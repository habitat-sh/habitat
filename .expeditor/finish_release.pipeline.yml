expeditor:
  accounts:
    - aws/chef-cd
  defaults:
    buildkite:
      timeout_in_minutes: 30
      env:
        HAB_ORIGIN: "core"
        PIPELINE_HAB_BLDR_URL: "https://bldr.habitat.sh"

steps:
  - label: ":github: Create GitHub Release"
    skip: "Not for testing"
    command:
      - .expeditor/scripts/finish_release/create_github_release.sh
    expeditor:
      secrets:
        GITHUB_TOKEN:
          account: github
          field: token
      executor:
        docker:

  - label: ":chocolate_bar: Publish Chocolatey package"
    skip: "Not for testing"
    command:
      - powershell .expeditor/scripts/finish_release/publish_to_chocolatey.ps1
    expeditor:
      secrets:
        CHOCO_API_KEY:
          path: account/static/chocolatey/habitat
          field: api_key
      executor:
        docker:
          host_os: windows
          environment:

  - label: ":rust: Check for new nightly rustfmt version"
    command:
      - .expeditor/scripts/finish_release/bump_rustfmt.sh
    expeditor:
      secrets:
        GITHUB_TOKEN:
          account: github
          field: token
      executor:
        linux:
          privileged: true
          environment:
            GITHUB_TOKEN
    soft_fail: true
